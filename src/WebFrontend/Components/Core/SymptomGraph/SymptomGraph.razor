@* D3.js Force-Directed Graph Component *@
@inherits ComponentBase
@implements IAsyncDisposable

<div id="@ElementId" class="w-full h-full relative overflow-hidden" style="background-color: rgba(0, 0, 0, 0.4);">
    @if (IsLoading)
    {
        <div class="absolute inset-0 flex items-center justify-center">
            <div class="text-xs font-mono uppercase tracking-widest" style="color: #06b6d4;">Loading graph...</div>
        </div>
    }
    
    @* Node Details Popup *@
    @if (SelectedNodeDetails != null && SelectedNodeId != null)
    {
        var selectedNode = Data?.Nodes.FirstOrDefault(n => n.Id == SelectedNodeId);
        <div class="absolute bottom-16 left-1/2 -translate-x-1/2 z-20 w-[360px] pointer-events-auto" style="font-family: monospace;">
            <div class="rounded-lg border overflow-hidden" style="background-color: rgba(13, 17, 23, 0.95); border-color: #fbbf24; box-shadow: 0 0 30px rgba(251, 191, 36, 0.2);">
                @* Header *@
                <div class="flex items-center justify-between px-4 py-2 border-b" style="border-color: #fbbf24; background-color: rgba(251, 191, 36, 0.1);">
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-amber-400 animate-pulse"></div>
                        <span class="text-amber-400 text-xs uppercase tracking-wider font-semibold">
                            @(selectedNode?.Label ?? SelectedNodeId)
                        </span>
                    </div>
                    <button 
                        @onclick="() => SelectedNodeId = null"
                        class="text-amber-400/60 hover:text-amber-400 transition-colors"
                        type="button">
                        <span class="material-symbols-outlined text-base">close</span>
                    </button>
                </div>
                
                @* Content *@
                <div class="p-4 space-y-3">
                    <p class="text-[11px] leading-relaxed" style="color: #d1d5db;">
                        @SelectedNodeDetails.Description
                    </p>
                    
                    @* Data Grid *@
                    <div class="grid grid-cols-3 gap-2 pt-2">
                        <div class="text-center p-2 rounded" style="background-color: rgba(6, 182, 212, 0.1);">
                            <div class="text-[9px] uppercase mb-1" style="color: rgba(6, 182, 212, 0.6);">Severity</div>
                            <div class="text-xs font-semibold @GetSeverityColorClass(SelectedNodeDetails.Severity)">
                                @SelectedNodeDetails.Severity
                            </div>
                        </div>
                        <div class="text-center p-2 rounded" style="background-color: rgba(6, 182, 212, 0.1);">
                            <div class="text-[9px] uppercase mb-1" style="color: rgba(6, 182, 212, 0.6);">Match</div>
                            <div class="text-xs font-semibold" style="color: #06b6d4;">@SelectedNodeDetails.Correlation</div>
                        </div>
                        <div class="text-center p-2 rounded" style="background-color: rgba(6, 182, 212, 0.1);">
                            <div class="text-[9px] uppercase mb-1" style="color: rgba(6, 182, 212, 0.6);">Onset</div>
                            <div class="text-xs font-semibold" style="color: #d1d5db;">@SelectedNodeDetails.Onset</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>
