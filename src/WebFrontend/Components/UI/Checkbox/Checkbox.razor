@using WebFrontend.Components.UI.Shared
@namespace WebFrontend.Components.UI.Checkbox

<button
    type="button"
    role="checkbox"
    aria-checked="@GetAriaChecked()"
    data-slot="checkbox"
    data-state="@(Checked ? "checked" : "unchecked")"
    data-size="@Size"
    class="@GetClass()"
    disabled="@Disabled"
    @onclick="HandleClick"
    @attributes="AdditionalAttributes">
    <span
        data-slot="checkbox-indicator"
        class="@GetIndicatorClass()">
        <svg class="size-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
    </span>
</button>

@code {
    [Parameter] public bool Checked { get; set; }
    [Parameter] public EventCallback<bool> CheckedChanged { get; set; }
    [Parameter] public string Size { get; set; } = "default";
    [Parameter] public bool Disabled { get; set; }
    [Parameter] public string? Class { get; set; }
    [Parameter(CaptureUnmatchedValues = true)] public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private string GetClass()
    {
        var baseClasses = "peer border-input bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/40 aria-invalid:border-destructive shrink-0 rounded-[4px] border shadow-xs transition-all duration-200 outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50";

        var sizeClasses = Size switch
        {
            "sm" => "data-[size=sm]:size-3",
            "lg" => "data-[size=lg]:size-5",
            _ => "data-[size=default]:size-4"
        };

        return ClassBuilder.Merge(baseClasses, sizeClasses, Class);
    }

    private string GetIndicatorClass()
    {
        if (Checked)
        {
            return "grid place-content-center text-current animate-in zoom-in-50 fade-in-0 duration-200";
        }
        else
        {
            return "grid place-content-center text-current animate-out zoom-out-50 fade-out-0 duration-150 pointer-events-none opacity-0";
        }
    }

    private string GetAriaChecked()
    {
        return Checked ? "true" : "false";
    }

    private async Task HandleClick()
    {
        if (!Disabled)
        {
            Checked = !Checked;
            await CheckedChanged.InvokeAsync(Checked);
        }
    }
}
