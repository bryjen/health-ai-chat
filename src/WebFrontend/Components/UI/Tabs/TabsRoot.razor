@using WebFrontend.Components.UI.Shared
@using WebFrontend.Components.UI.Tabs

@* Controlled tabs root that provides context to list, triggers, and content *@
<CascadingValue Value="_context">
    <div
        data-slot="tabs"
        data-orientation="@Orientation"
        class='@ClassBuilder.Merge("group/tabs flex gap-2", Orientation == "horizontal" ? "flex-col" : null, Class)'
        @attributes="AdditionalAttributes">
        @ChildContent
    </div>
</CascadingValue>

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public string? Value { get; set; }
    [Parameter] public EventCallback<string?> ValueChanged { get; set; }
    [Parameter] public string Orientation { get; set; } = "horizontal";
    [Parameter] public string? Class { get; set; }
    [Parameter(CaptureUnmatchedValues = true)] public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private TabsContext _context = default!;

    protected override void OnParametersSet()
    {
        _context ??= new TabsContext(Value, OnValueChangedFromContext, Orientation);
        _context.Value = Value;
    }

    private void OnValueChangedFromContext(string? newValue)
    {
        if (Value == newValue) return;
        Value = newValue;
        ValueChanged.InvokeAsync(newValue);
        StateHasChanged();
    }
}

