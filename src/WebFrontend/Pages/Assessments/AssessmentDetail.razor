@page "/assessments/{Id:int}"
@namespace WebFrontend.Pages.Assessments
@using Web.Common.DTOs.Health

<PageTitle>Assessment Details</PageTitle>

@if (IsLoading)
{
    <div class="flex items-center justify-center min-h-screen">
        <div class="text-muted-foreground">Loading assessment...</div>
    </div>
}
else if (ErrorMessage != null)
{
    <div class="flex items-center justify-center min-h-screen">
        <div class="text-destructive">@ErrorMessage</div>
    </div>
}
else if (Assessment == null)
{
    <div class="flex items-center justify-center min-h-screen">
        <div class="text-muted-foreground">Assessment not found</div>
    </div>
}
else
{
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="mb-6">
            <button @onclick="NavigateBack" 
                    class="text-muted-foreground hover:text-foreground mb-4 inline-flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">arrow_back</span>
                <span>Back to Chat</span>
            </button>
            <h1 class="text-3xl font-bold">Assessment Details</h1>
        </div>

        <div class="space-y-6">
            <!-- Hypothesis -->
            <div class="bg-card border rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-2">Hypothesis</h2>
                <p class="text-foreground">@Assessment.Hypothesis</p>
            </div>

            <!-- Confidence -->
            <div class="bg-card border rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-2">Confidence Level</h2>
                <div class="flex items-center gap-4">
                    <div class="flex-1 bg-muted rounded-full h-2.5">
                        <div class="bg-primary h-2.5 rounded-full" style="width: @(Assessment.Confidence * 100)%"></div>
                    </div>
                    <span class="text-lg font-medium">@(Assessment.Confidence.ToString("P0"))</span>
                </div>
            </div>

            <!-- Reasoning -->
            <div class="bg-card border rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-2">Reasoning</h2>
                <p class="text-foreground whitespace-pre-wrap">@Assessment.Reasoning</p>
            </div>

            <!-- Recommended Action -->
            <div class="bg-card border rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-2">Recommended Action</h2>
                <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-primary/10 text-primary">
                    <span class="material-symbols-outlined text-sm">medical_services</span>
                    <span>@GetRecommendedActionDisplay(Assessment.RecommendedAction)</span>
                </div>
            </div>

            <!-- Differential Diagnoses -->
            @if (Assessment.Differentials != null && Assessment.Differentials.Any())
            {
                <div class="bg-card border rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">Differential Diagnoses</h2>
                    <ul class="space-y-2">
                        @foreach (var differential in Assessment.Differentials)
                        {
                            <li class="flex items-start gap-2">
                                <span class="material-symbols-outlined text-sm text-muted-foreground mt-0.5">circle</span>
                                <span>@differential</span>
                            </li>
                        }
                    </ul>
                </div>
            }

            <!-- Metadata -->
            <div class="bg-card border rounded-lg p-6">
                <h2 class="text-xl font-semibold mb-4">Assessment Information</h2>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-muted-foreground">Created:</span>
                        <span>@Assessment.CreatedAt.ToString("MMMM dd, yyyy 'at' h:mm tt")</span>
                    </div>
                    @if (Assessment.EpisodeIds != null && Assessment.EpisodeIds.Any())
                    {
                        <div class="flex justify-between">
                            <span class="text-muted-foreground">Related Episodes:</span>
                            <span>@Assessment.EpisodeIds.Count episode(s)</span>
                        </div>
                    }
                    @if (Assessment.NegativeFindingIds != null && Assessment.NegativeFindingIds.Any())
                    {
                        <div class="flex justify-between">
                            <span class="text-muted-foreground">Negative Findings:</span>
                            <span>@Assessment.NegativeFindingIds.Count finding(s)</span>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
}
