@page "/settings/app-settings"
@layout SettingsLayout

<PageTitle>App Settings - Settings</PageTitle>

<section class="space-y-8">
    <div class="space-y-10">
        @RenderCard("Developer", RenderDeveloperSection)
        @RenderCard("Privacy", RenderPrivacySection)
        @RenderCard("Notifications", RenderNotificationsSection)
        @* @RenderCard("Application", RenderApplicationSection) *@
        @RenderCard("More", RenderMoreSection)
    </div>
</section>

@code {
    private RenderFragment RenderCard(string cardTitle, RenderFragment cardContent) => __builder =>
    {
        <div class="flex flex-col gap-3">
            <h2 class="font-semibold text-foreground !text-xs">
                @cardTitle
            </h2>
            <Card>
                <CardContent Class="space-y-6">
                    @cardContent
                </CardContent>
            </Card>
        </div>
    };

    private RenderFragment RenderDeveloperSection => __builder =>
    {
        <div class="space-y-6">
            @* Debug Mode *@
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1 space-y-1">
                    <div class="flex items-center gap-2">
                        <h3 class="text-sm font-medium text-foreground">Debug Mode</h3>
                        @if (Settings.DebugMode)
                        {
                            <span class="inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-xs font-medium text-primary">Active</span>
                        }
                    </div>
                    <p class="text-sm text-muted-foreground">
                        Enable detailed logging and diagnostic information. This will show console logs, API request/response details, and error stack traces.
                    </p>
                </div>
                <Switch Checked="@Settings.DebugMode" CheckedChanged="@((bool value) => OnDebugModeChanged(value))"/>
            </div>

            @* Developer Mode *@
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1 space-y-1">
                    <div class="flex items-center gap-2">
                        <h3 class="text-sm font-medium text-foreground">Developer Mode</h3>
                        @if (Settings.DeveloperMode)
                        {
                            <span class="inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-xs font-medium text-primary">Active</span>
                        }
                    </div>
                    <p class="text-sm text-muted-foreground">
                        Access advanced developer tools, experimental features, and API endpoints. Some features may be unstable or in beta.
                    </p>
                </div>
                <Switch Checked="@Settings.DeveloperMode" CheckedChanged="@((bool value) => OnDeveloperModeChanged(value))"/>
            </div>
        </div>
    };

    private RenderFragment RenderPrivacySection => __builder =>
    {
        <div class="space-y-6">
            @* Privacy Mode *@
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1 space-y-1">
                    <div class="flex items-center gap-2">
                        <h3 class="text-sm font-medium text-foreground">Privacy Mode (Legacy)</h3>
                        @if (Settings.PrivacyMode)
                        {
                            <span class="inline-flex items-center rounded-full bg-primary/10 px-2 py-0.5 text-xs font-medium text-primary">Active</span>
                        }
                    </div>
                    <p class="text-sm text-muted-foreground">
                        Your code data will not be trained on or used to improve the product. We will not store your code. Cloud Agent and some features not available.
                    </p>
                    <a href="#" class="text-xs text-primary hover:underline">Learn More</a>
                </div>
                <div class="flex items-center gap-2">
                    <Button Disabled Variant="outline" Size="sm" OnClick="@HandleEditPrivacyMode">Edit</Button>
                    <Switch Disabled Checked="@Settings.PrivacyMode" CheckedChanged="@((bool value) => OnPrivacyModeChanged(value))"/>
                </div>
            </div>

            @* Analytics *@
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1 space-y-1">
                    <h3 class="text-sm font-medium text-foreground">Analytics & Telemetry</h3>
                    <p class="text-sm text-muted-foreground">
                        Allow us to collect anonymous usage data to improve the application experience.
                    </p>
                </div>
                <Switch Disabled Checked="@Settings.AnalyticsEnabled" CheckedChanged="@((bool value) => OnAnalyticsChanged(value))"/>
            </div>
        </div>
    };

    private RenderFragment RenderNotificationsSection => __builder =>
    {
        <div class="space-y-6">
            @* Email Notifications *@
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1 space-y-1">
                    <h3 class="text-sm font-medium text-foreground">Email Notifications</h3>
                    <p class="text-sm text-muted-foreground">
                        Receive email updates about important account changes and system announcements.
                    </p>
                </div>
                <Switch Checked="@Settings.EmailNotifications" CheckedChanged="@((bool value) => OnEmailNotificationsChanged(value))"/>
            </div>

            @* Push Notifications *@
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1 space-y-1">
                    <h3 class="text-sm font-medium text-foreground">Push Notifications</h3>
                    <p class="text-sm text-muted-foreground">
                        Receive browser push notifications for real-time updates and alerts.
                    </p>
                </div>
                <Switch Checked="@Settings.PushNotifications" CheckedChanged="@((bool value) => OnPushNotificationsChanged(value))"/>
            </div>
        </div>
    };

    private RenderFragment RenderApplicationSection => __builder =>
    {
        <div class="space-y-6">
            @* Auto-save *@
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1 space-y-1">
                    <h3 class="text-sm font-medium text-foreground">Auto-save</h3>
                    <p class="text-sm text-muted-foreground">
                        Automatically save your work periodically to prevent data loss.
                    </p>
                </div>
                <Switch Checked="@Settings.AutoSave" CheckedChanged="@((bool value) => OnAutoSaveChanged(value))"/>
            </div>

            @* Performance Mode *@
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1 space-y-1">
                    <h3 class="text-sm font-medium text-foreground">Performance Mode</h3>
                    <p class="text-sm text-muted-foreground">
                        Optimize application performance by reducing animations and limiting background processes.
                    </p>
                </div>
                <Switch Checked="@Settings.PerformanceMode" CheckedChanged="@((bool value) => OnPerformanceModeChanged(value))"/>
            </div>

            @* API Rate Limiting *@
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1 space-y-1">
                    <h3 class="text-sm font-medium text-foreground">API Rate Limiting</h3>
                    <p class="text-sm text-muted-foreground">
                        Enable rate limiting to prevent excessive API calls and ensure fair usage.
                    </p>
                </div>
                <Switch Checked="@Settings.ApiRateLimiting" CheckedChanged="@((bool value) => OnApiRateLimitingChanged(value))"/>
            </div>
        </div>
    };

    private RenderFragment RenderMoreSection => __builder =>
    {
        <div class="space-y-6">
            @* Delete Account *@
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1 space-y-1">
                    <h3 class="text-sm font-medium text-foreground">Delete Account</h3>
                    <p class="text-sm text-muted-foreground">
                        Permanently delete your account and all associated data. This action cannot be undone.
                    </p>
                </div>
                <Button Variant="outline" Size="sm" Class="border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground" OnClick="@HandleDeleteAccount">
                    Delete
                </Button>
            </div>
        </div>
    };
}
